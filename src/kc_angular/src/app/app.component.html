<!--Copyright 2022 Rob Royce

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.-->

<!--Begin "Getting Ready" placeholder-->
<div *ngIf="!readyToShow" class="w-full h-full surface-a flex-col-center-center">
  <p-image src="assets/img/kc-logo-transparent.svg" class="w-5"></p-image>
  <p-progressBar mode="indeterminate" class="w-3"></p-progressBar>
  Getting things ready...
</div>
<!--End "Getting Ready" placeholder-->


<!--Begin main UI (top menubar and project viewport)-->
<div [hidden]="!readyToShow" style="height: 100vh; overflow: hidden">
  <p-menubar [model]="menuBarItems">
    <ng-template pTemplate="start">
      <p-button id="upNextButton"
                label="Up Next"
                icon="pi pi-arrow-circle-down"
                (onClick)="onOpenUpNext($event)"
                badgeClass="p-badge-danger"
                badge="{{ksQueue.length ? ksQueue.length : ''}}">
      </p-button>
    </ng-template>
    <div class="flex-row-center-between w-full">
      <button pButton class="p-button-sm p-button-text" (click)="onKcClick()">
        <img src="assets/img/kc-icon-transparent.png" height="24" width="24" alt="Knowledge Graph">
      </button>
      <input type="search" #searchBar pInputText placeholder="Search the web" (search)="search(searchBar.value)">
    </div>
  </p-menubar>
  <app-project-detail-viewport [showProjectTree]="projectTreeVisible"
                               [kcProject]="currentProject"
                               [treeNodes]="treeNodes"
                               [selectedNode]="selectedNode"
                               (onProjectCreation)="createProject($event)"
                               (onProjectDeletion)="deleteProject($event)"
                               (onTopicSearch)="searchTopic($event)"
                               (onHide)="projectTreeVisible = false"
                               (onShow)="projectTreeVisible = true">
  </app-project-detail-viewport>

  <!--Begin Notification Placeholders-->
  <p-confirmDialog appendTo="body"></p-confirmDialog>
  <p-messages key="app-banner"></p-messages>
  <p-toast key="app-toast"></p-toast>
  <!--End Notification Placeholders-->

  <!--Begin UpNext Knowledge Source Queue-->
  <p-overlayPanel #ksQueueOverlay
                  styleClass="surface-100 shadow-7"
                  [appendTo]="'body'"
                  [dismissable]="true">
    <ng-template pTemplate="content">
      You're all caught up!
    </ng-template>
  </p-overlayPanel>
  <p-dialog #ksUpNext
            [(visible)]="ksUpNextVisible"
            *ngIf="ksUpNextVisible"
            [modal]="true"
            [maximizable]="true"
            [draggable]="false"
            (close)="closeKsQueue()">
    <ng-template pTemplate="content">
      <app-ks-up-next [ksQueue]="ksQueue"
                      [projectTreeNodes]="ksQueueTreeNodes"
                      [selectedProject]="ksQueueSelectedNode"
                      (onClear)="clearQueue()"
                      (onClose)="closeKsQueue()"
                      (onUpdate)="ksQueueUpdate($event)"
                      (onRemove)="ksQueueRemove($event)">
      </app-ks-up-next>
    </ng-template>
    <ng-template pTemplate="footer"></ng-template>
  </p-dialog>
  <!--End UpNext Knowledge Source Queue-->

  <p-dialog [(visible)]="ksIngestVisible"
            [modal]="true"
            [maximizable]="true"
            [contentStyle]="{'width': '90vw'}">
    <app-ks-ingest *ngIf="ksIngestVisible"
                   (shouldClose)="ksIngestVisible = false">
    </app-ks-ingest>
  </p-dialog>

  <!--Begin Add Knowledge Source FAB-->
  <div style="" class="kc-speeddial" *ngIf="readyToShow && currentProject">
    <p-speedDial #importButton
                 direction="up"
                 (onClick)="onOpenIngest($event)">
    </p-speedDial>
  </div>
  <!--End Add Knowledge Source FAB-->

</div>
<!--End main UI (top menubar and project viewport)-->
